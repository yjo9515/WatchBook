import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter/src/widgets/framework.dart';
import 'package:flutter_blue_plus/flutter_blue_plus.dart';
import 'package:get/get.dart';
import 'package:wisemonster/controller/ble_controller.dart';
import 'package:wisemonster/controller/device_controller.dart';


class device_view  extends GetView<DeviceController> {
  @override
  Widget build(BuildContext context) {
    SystemChrome.setPreferredOrientations([DeviceOrientation.portraitUp]);
    return GetBuilder<DeviceController>(
        init: DeviceController(),
        builder: (DeviceController) =>
            WillPopScope(
                onWillPop: () => _goBack(context),
                child: Scaffold(
                  resizeToAvoidBottomInset: false,
                  body: Container(
                    padding: const EdgeInsets.fromLTRB(20, 90, 20, 20),
                    width:
                    MediaQueryData
                        .fromWindow(WidgetsBinding.instance!.window)
                        .size
                        .width,
                    //인풋박스 터치시 키보드 안나오는 에러 수정(원인 : 미디어쿼리)
                    height:
                    MediaQueryData
                        .fromWindow(WidgetsBinding.instance!.window)
                        .size
                        .height,
                    color: Colors.white,
                    child: Center(
                        child: Column(
                          mainAxisAlignment: MainAxisAlignment.center,
                          children: [
                            /* 연결 상태 */
                            Text(DeviceController.stateText),
                            /* 연결 및 해제 버튼 */
                            OutlinedButton(
                                onPressed: () {
                                  if (DeviceController.deviceState == BluetoothDeviceState.connected) {
                                    /* 연결된 상태라면 연결 해제 */
                                    DeviceController.disconnect();
                                  } else if (DeviceController.deviceState == BluetoothDeviceState.disconnected) {
                                    /* 연결 해재된 상태라면 연결 */
                                    DeviceController.connect();
                                  } else {}
                                },
                                child: Text(DeviceController.connectButtonText)),
                            DeviceController.buildServices(),
                            Expanded(
                              child: ListView.separated(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           itemCount: DeviceController.bluetoothService.length,
                                itemBuilder: (context, index) {
                                  return DeviceController.listItem(DeviceController.bluetoothService[index]);
                                },
                                separatorBuilder: (BuildContext context, int index) {
                                  return Divider();
                                },
                              ),
                            ),
                          ],
                        )),
                        )),
                  ),

            );
  }









    Future<bool> _goBack(BuildContext context) async {
      return true;
    }
}
